## ТЗ: улучшение поиска неиспользуемых типов XSD (xmlschema-based)

### Цель
Повысить точность и покрытие скрипта `tools/xsd-tools/check_unused_types_xmlschema.py`, чтобы он корректно определял реально неиспользуемые типы в схемах с import/include, учитывал атрибуты/группы/подстановки и позволял конфигурировать точки входа. Минимизировать ложные срабатывания и шум, сохранив обратную совместимость по CLI.

### Область
- Основной скрипт: `tools/xsd-tools/check_unused_types_xmlschema.py`.
- Тесты: `tools/xsd-tools/tests/test_check_unused_types_xmlschema.py`.
- Не менять XSD-схемы/документацию; только код и тесты скрипта.

### Требования к функционалу
1) Точки входа в граф
   - По умолчанию: все глобальные elements/attributes во всех схемах, включая import/include (как сейчас).
   - Новый флаг `--roots <qname,...>`: задаёт конкретные корневые elements/attributes (QName или {ns}local). Если указан, обход начинается только от них.
   - Новый флаг `--all-globals` (bool): дополнительно стартовать от global groups/attributeGroups (для библиотечных схем без корней).

2) Обход компонентной модели
   - Уже есть: base_type, item_type, member_types, content/model_group iter_elements, attributes.
   - Добавить:
     - attributeGroup ссылки (global и локальные), group references (для seq/choice/all), wildcard (any/anyAttribute) игнорируются как типы, но не должны ломать обход.
     - substitutionGroup: если элемент входит в группу подстановки, типы элементов из группы считаются достижимыми.
     - identity constraints: не считаем типы “использованными”, но добавляем отдельный список “only in identity constraint” в выводе (для осознанного решения).
     - redefine: если используется, учитывать переопределения типов/групп.

3) Учёт namespace и импортов
   - Прежнее поведение: include/import ходим по умолчанию; флаг `--no-include-imports` сохраняем.
   - Резолвинг schemaLocation: локальные относительные пути от каталога целевой схемы; при невозможности загрузить импорт выводить предупреждение в stderr и помечать отчётным статусом.
   - Всегда игнорировать `xs:*` типы (как сейчас).

4) Отчётность/вывод
   - Формат stdout оставить совместимым: Schema/Declared/Types referenced/unused list.
   - Добавить блок (если непусто):
     - “Only referenced in identity constraints:” список типов.
     - “Imports not loaded:” список schemaLocation/namespace (если были ошибки).
   - Порядок списков — отсортированный по имени.

5) Опции шума
   - Флаг `--ignore <name,...>`: помечает типы как “используемые вручную” (например, для внешних ссылок). При наличии не выводить их в unused.
   - Флаг `--allow-empty-roots`: если нет стартовых узлов (и не указан `--all-globals`), завершать с кодом 1 и сообщением; с флагом — продолжать (но помечать, что стартовые узлы пусты).

### Нефункциональные
- Python 3.11+, зависимости — только stdlib + xmlschema (как сейчас).
- Кодировка UTF-8.
- Время работы на текущем наборе схем — не хуже текущего (секунды, а не минуты).
- Логика не должна менять существующие флаги/их смыслы.

### Тесты (pytest, tools/xsd-tools/tests)
Добавить новые кейсы, сохранить существующие:
1) Подстановка substitutionGroup: тип из члена группы должен считаться используемым.
2) attributeGroup/group: типы атрибутов/элементов внутри глобальных групп, подключённых к типу, считаются использованными.
3) Identity constraint: тип элемента, встречающийся только в key/keyref/unique, попадает в список “only in identity constraints”, но остаётся в основном unused (проверить вывод).
4) Режим `--roots`: при указании конкретного элемента учитываются только достижимые из него типы.
5) Режим `--all-globals`: при отсутствии корней, но с этим флагом, группы/атрибутные группы становятся стартом и типы внутри не считаются неиспользуемыми.
6) `--ignore`: тип, попавший в unused, исключается из списка при указании во флаге.
7) Ошибка импорта: при неразрешённом schemaLocation скрипт не падает, фиксирует предупреждение в stderr и выводит “Imports not loaded”.
8) Совместимость вывода: базовый кейс без новых ситуаций остаётся без дополнительных блоков.

### Приёмочные критерии
- Все новые и существующие тесты проходят.
- На основной схеме нет ложных срабатываний: все объявленные типы используются.
- При искусственно сломанном импорте скрипт завершает с кодом 0, но предупреждает и фиксирует “Imports not loaded”.
- Документация по флагам обновлена в docstring/--help.

### План работ (в коде)
1) Расширить обход (substitutionGroup, groups, attrGroups, identity constraints маркеры).
2) Добавить новые CLI-флаги (`--roots`, `--all-globals`, `--ignore`, `--allow-empty-roots`), сохранить существующие.
3) Реализовать сбор статуса импортов (ошибки/skip) с выводом.
4) Обновить вывод (доп. блоки).
5) Покрыть тестами сценарии выше.

-### Что не делаем
- Не меняем другие скрипты (compare_xsd_*).
- Не правим схемы/XSL/документацию.
