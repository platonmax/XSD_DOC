## ТЗ по обновлению визуалки БИМ 3.01 (копия NEW)

### Цель
Перенести современные стили и UX-паттерны из визуалок СВОР/ВОР в БИМ 3.01, сохранив структуру отчёта и совместимость данных. Работать в копии `LocalEstimateBaseIndexMethod-3_01_NEW.xsl`, не затрагивая рабочую версию.

### Область работ
- XSL-шаблон: `LocalEstimateBaseIndexMethod/LocalEstimateBaseIndexMethod-3_01_NEW.xsl`.
- Проверочный пример: `LocalEstimateBaseIndexMethod/БИМ_3.01_Пример 1 (2).gge` (и дополнительные примеры, если появятся).
- Вывод: HTML-отчёт, визуально сопоставимый с текущим, но с обновлёнными стилями и улучшенной читаемостью числовых колонок.

### Требования к визуальному стилю
1) Базовые токены (по аналогии с СВОР/ВОР):
   - Цвета в `:root`: `--bg`, `--card`, `--border`, `--text`, `--muted`, `--primary`, `--accent`, `--danger`, `--danger-bg`.
   - Шрифты: `"Inter", "Segoe UI", system-ui, -apple-system, sans-serif`; базовый размер 10pt.
   - Фон страницы: светлый градиент или однотонный в тон `--bg`.
2) Карточная структура:
   - Обёртка `.page/.main` с gap.
   - Блоки-таблицы без внешних рамок, с внутренними отступами (padding) и скруглением/тенью по аналогии с СВОР (минималистично).
3) Таблицы:
   - `table-layout: fixed`, `border-collapse: separate` + `border-spacing: 0` (как в СВОР) для устойчивой сетки.
   - Явные классы ширин для колонок (номера, обоснование, наименование, единица, кол-во, стоимостные, индексы).
   - `white-space`/`word-break` контролировать через классы `.right`, `.nowrap`, `.wrap` вместо `nowrap`-атрибутов.
   - Полосатость строк (`nth-child`) и фоновая подсветка итогов/разделов.
4) Шапка таблицы:
   - Единый стиль th: выравнивание, padding, фон, рамка.
   - Подписи многострочные через `white-space: normal; word-break: break-word`.
5) Колонка 10 (проблемная):
   - Класс `col-10` с `min-width` (старт 80–90px) и `white-space: nowrap; text-align: right;`.
   - Применить и к `th`, и к `td`.
6) Валюта/числа:
   - Правые колонки — `text-align: right; white-space: nowrap;`.
   - Сохраняем форматирование чисел из текущих функций.
7) Заголовочные блоки/подписи:
   - Использовать фиксированный набор классов для линий с подписями (аналог header-table в СВОР): label (мин. ширина), line (растягивается), hint.

### Требования к структуре XSL/CSS
1) Вынести стили в CSS-блок (без inline width/no-wrap). Минимизировать атрибуты width/nowrap на td/th; заменить на классы.
2) Ввести классы колонок: `col-n`, `col-reason`, `col-name`, `col-unit`, `col-qty`, `col-price-base`, `col-price-current`, `col-index`, `col-total`, `col-10` и т.п. Согласовать набор после инвентаризации таблиц.
3) Сохранить все объединения ячеек (colspan/rowspan) и порядок колонок 1–12.
4) Не менять бизнес-логику и вычисления XSL; правим только разметку/стили.

### Инвентаризация (до правок)
1) Составить список таблиц и их колонок (основная таблица, итоги, вложенные блоки, справочные разделы).
2) Зафиксировать текущие inline-ширины и nowrap, чтобы перенести их в классы.

### План работ
1) Базовая подготовка:
   - Инвентаризация колонок и inline-стилей в `LocalEstimateBaseIndexMethod-3_01_NEW.xsl`.
   - Добавить блок токенов `:root` и базовую типографику (как в СВОР/ВОР).
2) Сетка и классы:
   - Включить `table-layout: fixed` и базовые параметры таблиц.
   - Завести классы колонок, перенести widths/nowrap из inline в CSS.
   - Настроить шапку: единый стиль th, многострочные подписи.
3) Числовые колонки:
   - Применить `.right`/`.nowrap` и `col-10` для проблемной колонки; проверить 10-й столбец на примере.
   - Убедиться, что индексы/итоги не переносят числа.
4) Полосатость и фон:
   - Лёгкая зебра для строк, фон для итогов/разделов, без перегруза.
5) Тестирование:
   - Прогнать `БИМ_3.01_Пример 1 (2).gge` → `_NEW.html`.
   - Проверить ширины колонок 8–12 и отсутствие переноса в 10-й.
   - При необходимости увеличить `min-width` для колонки 10 и смежных.
6) Финализация:
   - Очистить остаточные inline-стили (width/nowrap) если дублируют классы.
   - Обновить историю задачи.

### Критерии приёмки
- В 10-й колонке (и других числовых) числа ≥1000 не переносятся; выравнивание вправо.
- Шапка и тело таблицы визуально согласованы (отступы, фон, рамки).
- Нет утраты содержимого/колонок; порядок 1–12 сохранён.
- Стили сосредоточены в CSS; inline-ширины/nowrap сведены к минимуму.
- Отчёт читается на экране без горизонтального скролла при ширине ≥1920px (допустим горизонтальный скролл ниже этой ширины).

### Артефакты
- Рабочий XSL: `LocalEstimateBaseIndexMethod-3_01_NEW.xsl`.
- Тестовый HTML: `БИМ_3.01_Пример 1 (2)_NEW.html` (после прогона).
- История: `LocalEstimateBaseIndexMethod/1053/1053.md` обновлять после значимых шагов.
